(this.webpackJsonpssup=this.webpackJsonpssup||[]).push([[0],{129:function(e,t,n){"use strict";n.r(t);var c=n(0),a=n(25),r=n.n(a),s=n(7),i=n(27);function o(e,t){var n="ssup-"+e,a=Object(c.useState)((function(){var e=localStorage.getItem(n);return null!=e?JSON.parse(e):"function"===typeof t?t():t})),r=Object(s.a)(a,2),i=r[0],o=r[1];return Object(c.useEffect)((function(){i&&(!function(){function e(){var e=0,t=JSON.parse(localStorage.getItem("ssup-conversations"));t&&(t=t.map((function(t,n){return t.messages=t.messages.filter((function(t){return!(!e&&"text"!==t.type)||(e++,!1)})),t})),window.location.reload()),localStorage.setItem("ssup-conversations",JSON.stringify(t))}for(;Number(encodeURIComponent(JSON.stringify(localStorage.getItem("ssup-conversations")).length/1024)).toFixed(0)>4e3;)e()}(),localStorage.setItem(n,JSON.stringify(i)))}),[i,n]),[i,o,function(){localStorage.removeItem(n)}]}var l=n(1),j=Object(c.createContext)();function d(){return Object(c.useContext)(j)}function u(e){var t=e.children,n=o("contacts",[]),c=Object(s.a)(n,2),a=c[0],r=c[1];return Object(l.jsx)(j.Provider,{value:{contacts:a,createContact:function(e,t){a.some((function(t){return t.id===e}))?alert("Oops! entry already exists."):r((function(n){return[].concat(Object(i.a)(n),[{id:e,name:t,isOnline:!1}])}))},removeContact:function(e){r((function(t){return t.filter((function(t,n){return e!==n}))}))},updateContacts:r},children:t})}var b=n(11),O=n(78),f=n.n(O),x=Object(c.createContext)();function m(){return Object(c.useContext)(x)}function h(e){var t=e.id,n=e.children,a=Object(c.useState)(),r=Object(s.a)(a,2),i=r[0],o=r[1],j=d().contacts,u=Object(c.useState)([]),b=Object(s.a)(u,2),O=b[0],m=b[1];return Object(c.useEffect)((function(){var e=f()("https://ssup-backend.herokuapp.com/",{query:{id:t}});return o(e),function(){return e.close()}}),[t]),Object(c.useEffect)((function(){if(null!=i)return i.on("online-users",m),function(){return i.off("online-users")}}),[j,i]),Object(l.jsx)(x.Provider,{value:{socket:i,onlineUsers:O},children:n})}var v=Object(c.createContext)();function g(){return Object(c.useContext)(v)}function p(e){var t=e.id,n=e.children,a=o("conversations",[]),r=Object(s.a)(a,2),j=r[0],u=r[1],O=m().socket,f=Object(c.useState)(0),x=Object(s.a)(f,2),h=x[0],g=x[1],p=d().contacts;var y=Object(c.useCallback)((function(e){var t=e.recipients,n=e.body,c=e.type,a=e.sender;u((function(e){var r=!1,s={sender:a,body:n,type:c},o=e.map((function(e){return n=e.recipients,c=t,n.length===c.length&&(n.sort(),c.sort(),n.every((function(e,t){return e===c[t]})))?(r=!0,Object(b.a)(Object(b.a)({},e),{},{messages:[].concat(Object(i.a)(e.messages),[s])})):e;var n,c}));return r?o:[].concat(Object(i.a)(e),[{recipients:t,messages:[s]}])}))}),[u]);Object(c.useEffect)((function(){if(null!=O)return O.on("receive-message",y),function(){O.off("receive-message")}}),[O,y]);var C=j.map((function(e,n){var c=e.recipients.map((function(e){var t=p.find((function(t){return t.id===e})),n=t&&t.name;return{id:e,name:n}})),a=e.messages.map((function(e){var n=p.find((function(t){return t.id===e.sender})),c=t===e.sender;return Object(b.a)(Object(b.a)({},e),{},{senderName:n&&n.name,senderID:e.sender,fromMe:c})})),r=n===h;return Object(b.a)(Object(b.a)({},e),{},{messages:a,recipients:c,selected:r})})),N={conversations:C,selectedConversation:C[h],createConversation:function(e){u((function(t){return[].concat(Object(i.a)(t),[{recipients:e,messages:[]}])}))},removeConversation:function(e){u((function(t){return t.filter((function(t,n){return e!==n}))}))},sendMessage:function(e){var n=e.recipients,c=e.body,a=e.type;O.emit("send-message",{recipients:n,body:c,type:a}),y({recipients:n,body:c,type:a,sender:t})},selectConversationIndex:g};return Object(l.jsx)(v.Provider,{value:N,children:n})}var y=n(132),C=n(142),N=n(133);function w(){var e=o("id")[2],t=Object(c.useState)(!1),n=Object(s.a)(t,2),a=n[0],r=n[1];function i(){r(!1)}return Object(l.jsxs)("div",{style:{position:"fixed",right:0},children:[Object(l.jsx)(y.a,{size:"sm",className:"d-flex align-items-center",onClick:function(){r(!0)},children:Object(l.jsx)(N.a,{className:"mr-2",size:30})}),Object(l.jsxs)(C.a,{show:a,onHide:i,children:[Object(l.jsx)(C.a.Header,{children:Object(l.jsx)("h5",{className:"m-0",children:"You will be logged out!"})}),Object(l.jsxs)(C.a.Body,{children:[Object(l.jsx)("p",{children:"Please save your ID before logging out or you may lose it."}),Object(l.jsxs)("div",{className:"d-flex justify-content-end",children:[Object(l.jsx)(y.a,{variant:"danger",className:"mx-2",onClick:function(){e(),i(),window.location.reload()},children:"Okay"}),Object(l.jsx)(y.a,{variant:"secondary",onClick:i,children:"Cancel"})]})]})]})]})}var S=n(59),I=n(60),k=n(143),D=n(134),M=new(n(80).ImageCompressor);function P(){var e=Object(c.useState)(""),t=Object(s.a)(e,2),n=t[0],a=t[1],r=Object(c.useState)(),i=Object(s.a)(r,2),o=i[0],j=i[1],d=g(),u=d.sendMessage,O=d.selectedConversation,f=Object(c.useRef)();return Object(l.jsx)(k.a,{onSubmit:function(e){if(e.preventDefault(),o){var t=URL.createObjectURL(o);(c=t,new Promise((function(e){var t=new Image;t.onload=function(){e({height:t.height,width:t.width})},t.src=c}))).then((function(e){var n=e.height,c=e.width,a=n/c<1?{toWidth:c>800?800:c}:{toHeight:n>800?800:n},r=Object(b.a)(Object(b.a)({},a),{},{mimeType:"image/png",mode:"strict",quality:0});M.run(t,r,(function(e){u({recipients:O.recipients.map((function(e){return e.id})),body:e,type:o.type}),j(),f.current.value=null}))}))}else u({recipients:O.recipients.map((function(e){return e.id})),body:n,type:"text"});var c;a("")},children:Object(l.jsx)(k.a.Group,{className:"m-1",children:Object(l.jsxs)(D.a,{className:"d-flex align-items-center",children:[Object(l.jsx)(D.a.Prepend,{children:Object(l.jsxs)("div",{className:"mx-2",children:[Object(l.jsx)(k.a.Control,{ref:f,onChange:function(e){var t=e.target.files[0];a(t.name),j(t)},type:"file",className:"d-none",accept:".png, .jpg, .jpeg"}),Object(l.jsx)(S.a,{onClick:function(){f.current.click()},icon:I.a,size:"2x"})]})}),Object(l.jsx)(k.a.Control,{placeholder:"type your message here..",as:"textarea",required:!0,value:n,onChange:function(e){return a(e.target.value)},style:{height:"100px",resize:"none"}}),Object(l.jsx)(D.a.Append,{children:Object(l.jsxs)(y.a,{variant:"success",type:"submit",className:"d-flex flex-column align-items-center justify-content-center",children:[Object(l.jsx)(S.a,{icon:I.b,size:"2x"}),"Send"]})})]})})})}var z=n(81),F=n.n(z);function H(){var e=Object(c.useCallback)((function(e){e&&e.scrollIntoView({behavior:"smooth"})}),[]),t=g().selectedConversation;return Object(l.jsxs)("div",{className:"d-flex  flex-column flex-grow-1 border-left",children:[Object(l.jsx)("h5",{className:"text-white pl-2 bg-primary text-capitalize py-2 rounded",children:t.recipients.map((function(e){return e.name&&e.name||"Unknown"})).join(", ")}),Object(l.jsx)("div",{className:"flex-grow-1 overflow-auto",children:Object(l.jsx)("div",{className:"d-flex flex-column align-items-start justify-content-end px-3",children:t.messages.map((function(t,n){return"text"===t.type?Object(l.jsxs)("div",{ref:e,className:"d-flex flex-column ".concat(t.fromMe?"align-self-end align-items-end":"align-items-start"),children:[Object(l.jsx)("div",{className:"rounded px-2 py-1 font-weight-bold ".concat(t.fromMe?"bg-primary text-white":"bg-light"),children:t.body}),Object(l.jsx)(c,{})]},n):Object(l.jsxs)("div",{ref:e,className:"".concat(t.fromMe?"align-self-end":"align-self-start "),children:[Object(l.jsx)("div",{style:{width:166},className:"".concat(t.fromMe?"bg-primary":"bg-light"," p-1 rounded d-flex justify-content-center"),children:Object(l.jsx)(F.a,{style:{width:156},src:t.body,alt:"sent by ".concat(t.senderName?t.senderName:t.fromMe?"you":"unknown contact")})}),Object(l.jsx)(c,{})]},n);function c(){return Object(l.jsx)("div",{className:"mb-2 small ".concat(t.senderName&&"text-capitalize"," px-1 ").concat(t.fromMe?"align-self-end":""),children:t.fromMe?"You":t.senderName&&t.senderName||t.senderID})}}))})}),Object(l.jsx)(P,{})]})}var L=n(146),B=n(144),J=n(139),R=n(140),T=n(147),q=n(135),E=n(136);function U(e){var t=e.dialogue,n=e.onPressDelete,c=e.closeModal;return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(C.a.Header,{closeButton:!0,children:Object(l.jsx)(C.a.Title,{children:"Confirm Delete?"})}),Object(l.jsx)(C.a.Body,{children:Object(l.jsx)("p",{children:t})}),Object(l.jsxs)(C.a.Footer,{children:[Object(l.jsx)(y.a,{variant:"danger",onClick:n,children:"Delete"}),Object(l.jsx)(y.a,{onClick:c,variant:"secondary",children:"Cancel"})]})]})}function G(){var e=d(),t=e.contacts,n=e.removeContact,a=Object(c.useState)(!1),r=Object(s.a)(a,2),i=r[0],o=r[1],j=Object(c.useState)(),u=Object(s.a)(j,2),b=u[0],O=u[1],f=Object(c.useState)(),x=Object(s.a)(f,2),m=x[0],h=x[1];function v(){o(!1)}return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(C.a,{show:i,onHide:v,children:Object(l.jsx)(U,{dialogue:'Contact entry "'.concat(b,'" will be removed!'),closeModal:function(){return o(!1)},onPressDelete:function(){n(m),v()}})}),Object(l.jsx)(T.a,{variant:"flush",children:t.map((function(e,t){return Object(l.jsxs)(T.a.Item,{variant:"primary",children:[Object(l.jsxs)("div",{className:"d-flex justify-content-between align-items-center",children:[Object(l.jsxs)("div",{className:"d-flex align-items-center col-md-11 p-0",children:[Object(l.jsx)(q.a,{}),Object(l.jsx)("p",{className:"m-0 p-0 ml-2 text-capitalize font-weight-bold col-md-10 text-break",children:e.name})]}),Object(l.jsx)(E.a,{className:"text-danger",onClick:function(){O(e.name),h(t),o(!0)}})]}),Object(l.jsx)("p",{className:"text-muted m-0 mt-1 font-weight-lighter text-center",style:{fontSize:14},children:e.id})]},e.id)}))})]})}var K=n(137);function Y(){var e=Object(c.useState)(!1),t=Object(s.a)(e,2),n=t[0],a=t[1],r=Object(c.useState)(),i=Object(s.a)(r,2),o=i[0],j=i[1],d=Object(c.useState)(),u=Object(s.a)(d,2),b=u[0],O=u[1],f=g(),x=f.conversations,h=f.selectConversationIndex,v=f.removeConversation,p=m().onlineUsers;function y(){a(!1)}return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(C.a,{show:n,onHide:y,children:Object(l.jsx)(U,{dialogue:'Your conversation with "'.concat(o,'" will be deleted!'),closeModal:function(){return a(!1)},onPressDelete:function(){v(b),y(),h(0)}})}),Object(l.jsx)(T.a,{variant:"flush",children:x.map((function(e,t){var n="text-capitalize",c=e.recipients.map((function(e){var t="";return p.includes(e.id)&&(t=" (online)"),null!=e.name?e.name+t:(n="small",e.id+t)})).join(", ");return Object(l.jsxs)(T.a.Item,{className:"d-flex justify-content-between align-items-center "+n,action:!0,variant:"dark",onClick:function(){h(t)},active:e.selected,children:[Object(l.jsxs)("div",{className:"col-md-11 d-flex align-items-center p-0",children:[Object(l.jsx)(K.a,{className:"mr-2"}),Object(l.jsx)("div",{className:"col-md-10 p-0 text-break",children:c})]}),Object(l.jsx)(E.a,{className:"text-danger",onClick:function(){return function(e,t){j(t),O(e),a(!0)}(t,c)}})]},t)}))})]})}function A(e){var t=e&&e.toString();if(t&&t.length>9){if(10===t.length&&!/\D/.test(t))return"number";if(t.length>10&&/\d/.test(t)&&/[a-z]/.test(t))return"id"}return!1}var W=n(138);function V(e){var t=e.heading,n=e.body,c=e.show,a=e.style,r=e.focusOn;return c?(r&&r.current&&r.current.focus&&r.current.focus(),Object(l.jsxs)(W.a,{className:"position-absolute w-100 text-center rounded",style:Object(b.a)({zIndex:99},a),variant:"danger",children:[Object(l.jsx)(W.a.Heading,{children:t}),Object(l.jsx)("p",{className:"m-0",children:n})]})):Object(l.jsx)("div",{})}function Q(e){var t=e.closeModal,n=Object(c.useRef)(),a=Object(c.useRef)(),r=d().createContact,i=Object(c.useState)(!1),o=Object(s.a)(i,2),j=o[0],u=o[1];return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(V,{focusOn:n,heading:"Invalid ID!",body:"Please input a valid ID to create a contact.",show:j}),Object(l.jsx)(C.a.Header,{children:"Create Contact"}),Object(l.jsx)(C.a.Body,{children:Object(l.jsxs)(k.a,{onSubmit:function(e){e.preventDefault();var c=n.current.value.trim();A(c)?(r(c,a.current.value),t()):(u(!0),setTimeout((function(){return u(!1)}),1e3))},children:[Object(l.jsxs)(k.a.Group,{children:[Object(l.jsx)(k.a.Label,{children:"Id"}),Object(l.jsx)(k.a.Control,{type:"text",ref:n,required:!0})]}),Object(l.jsxs)(k.a.Group,{children:[Object(l.jsx)(k.a.Label,{children:"Name"}),Object(l.jsx)(k.a.Control,{type:"text",ref:a,required:!0})]}),Object(l.jsx)(y.a,{type:"submit",children:"Create"})]})})]})}function X(e){var t=e.closeModal,n=Object(c.useState)([]),a=Object(s.a)(n,2),r=a[0],o=a[1],j=d().contacts,u=g().createConversation,b=Object(c.useState)(!1),O=Object(s.a)(b,2),f=O[0],x=O[1];return Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)(V,{heading:"Oops!",body:"No contacts selected!",show:f}),Object(l.jsx)(C.a.Header,{children:Object(l.jsx)("h4",{children:"Create Conversation"})}),Object(l.jsx)(C.a.Body,{children:j.length<1?Object(l.jsx)("p",{className:"text-center text-danger font-weight-bold",children:'"Add contact before creating new conversation!"'}):Object(l.jsxs)(k.a,{onSubmit:function(e){e.preventDefault(),r.length?(u(r),t()):(x(!0),setTimeout((function(){return x(!1)}),500))},children:[j.map((function(e){return Object(l.jsx)(k.a.Group,{controlId:e.id,children:Object(l.jsx)(k.a.Check,{type:"checkbox",value:r.includes(e.id),label:e.name,onChange:function(){return t=e.id,void o((function(e){return e.includes(t)?e.filter((function(e){return t!==e})):[].concat(Object(i.a)(e),[t])}));var t}})},e.id)})),Object(l.jsx)(y.a,{type:"submit",children:"Create"})]})})]})}var Z="conversations",$="contacts",_="d-flex align-items-center justify-content-around m-0";function ee(e){var t=e.id,n=Object(c.useState)(Z),a=Object(s.a)(n,2),r=a[0],i=a[1],o=Object(c.useState)(!1),j=Object(s.a)(o,2),d=j[0],u=j[1];function b(){u(!1)}var O=r===Z;return Object(l.jsxs)("div",{style:{maxWidth:"290px",width:"50vw",background:"linear-gradient(#fff 10%, #ddd)"},className:"d-flex flex-column  border-right",children:[Object(l.jsxs)(L.a.Container,{activeKey:r,onSelect:i,children:[Object(l.jsxs)(B.a,{variant:"tabs",className:"justify-content-center",children:[Object(l.jsx)(B.a.Item,{children:Object(l.jsx)(B.a.Link,{eventKey:Z,children:"Conversations"})}),Object(l.jsx)(B.a.Item,{children:Object(l.jsx)(B.a.Link,{eventKey:$,children:"Contacts"})})]}),Object(l.jsxs)(L.a.Content,{className:"overflow-auto flex-grow-1",children:[Object(l.jsx)(L.a.Pane,{eventKey:Z,children:Object(l.jsx)(Y,{})}),Object(l.jsx)(L.a.Pane,{eventKey:$,children:Object(l.jsx)(G,{})})]}),Object(l.jsxs)("div",{className:"p-2 border-top small",children:["Your ID : ",Object(l.jsx)("span",{className:"text-muted",children:t})]}),Object(l.jsx)(y.a,{variant:"dark",size:"sm",className:"m-2",onClick:function(){return u(!0)},children:O?Object(l.jsxs)("div",{className:_,children:["New Conversation ",Object(l.jsx)(J.a,{})]}):Object(l.jsxs)("div",{className:_,children:["Add New Contact ",Object(l.jsx)(R.a,{})]})})]}),Object(l.jsx)(C.a,{show:d,onHide:b,children:O?Object(l.jsx)(X,{closeModal:b}):Object(l.jsx)(Q,{closeModal:b})})]})}function te(e){var t=e.id,n=g().selectedConversation;return Object(l.jsxs)("div",{className:"d-flex",style:{height:"100vh"},children:[Object(l.jsx)(ee,{id:t}),Object(l.jsx)("div",{className:"d-flex flex-grow-1",style:{background:"linear-gradient(to right, #abc, #ddd)"},children:n?Object(l.jsx)(H,{}):Object(l.jsx)(ne,{})}),Object(l.jsx)(w,{})]})}function ne(){return Object(l.jsx)("div",{className:"d-flex flex-grow-1 justify-content-center align-items-center",children:Object(l.jsx)("p",{className:"text-muted",children:"Conversations will display here!"})})}var ce=n(141),ae=n(145);function re(e){var t=e.onIdSubmit,n=Object(c.useRef)(),a=Object(c.useState)(!1),r=Object(s.a)(a,2),i=r[0],o=r[1];return Object(l.jsxs)(l.Fragment,{children:[" ",Object(l.jsx)(V,{focusOn:n,heading:"Invalid ID!",body:"Please input a valid ID to login or create a new ID.",show:i}),Object(l.jsx)(ce.a,{className:"align-items-center d-flex",style:{height:"100vh"},children:Object(l.jsxs)(k.a,{className:"w-100",onSubmit:function(e){e.preventDefault();var c=n.current.value.trim();A(c)?t(c):(o(!0),setTimeout((function(){return o(!1)}),1e3))},children:[Object(l.jsxs)(k.a.Group,{children:[Object(l.jsx)(k.a.Label,{children:"Enter Your ID"}),Object(l.jsx)(k.a.Control,{type:"text",ref:n,required:!0})]}),Object(l.jsx)(y.a,{type:"submit",className:"mr-2",children:"Login"}),Object(l.jsx)(y.a,{variant:"secondary",onClick:function(){t(Object(ae.a)())},children:"Create A New Id"})]})})]})}var se=function(){var e=o("id"),t=Object(s.a)(e,2),n=t[0],c=t[1];return n?Object(l.jsx)(u,{id:n,children:Object(l.jsx)(h,{id:n,children:Object(l.jsx)(p,{id:n,children:Object(l.jsx)(te,{id:n})})})}):Object(l.jsx)(re,{onIdSubmit:c})},ie=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,148)).then((function(t){var n=t.getCLS,c=t.getFID,a=t.getFCP,r=t.getLCP,s=t.getTTFB;n(e),c(e),a(e),r(e),s(e)}))};n(128);r.a.render(Object(l.jsx)(se,{}),document.getElementById("root")),ie()}},[[129,1,2]]]);
//# sourceMappingURL=main.9d84c0cb.chunk.js.map